/* Map wrapper background and base sizing */
.map-wrapper {
  position: relative;
  background: #cfeaf3; /* pale map water */
  border-top: 1px solid #e0e0e0;
  min-height: 640px;
  box-sizing: border-box;
}

.map-container {
  width: 100%;
  height: 640px;
  position: relative;
}

.map {
  width: 100%;
  height: 100%;
}

.loading,
.error {
  padding: 2rem;
  text-align: center;
  font-size: 1.2rem;
}

.error {
  color: #d32f2f;
}

.popup-content h3 {
  margin-top: 0;
  margin-bottom: 0.5rem;
  color: #1a73e8;
}

.popup-content p {
  margin: 0.25rem 0;
}

/* Professional popup styling for map markers */
.leaflet-popup-content-wrapper {
  border-radius: 8px !important;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
  border: none !important;
}

.leaflet-popup-content {
  margin: 12px 16px !important;
  line-height: 1.4 !important;
  font-size: 14px !important;
  min-width: 180px !important;
  max-width: 240px !important;
}

.popup-content {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
}

.popup-content h3 {
  margin: 0 0 8px 0 !important;
  font-size: 16px !important;
  font-weight: 600 !important;
  color: #1976d2 !important;
  line-height: 1.3 !important;
}

.popup-content p {
  margin: 4px 0 !important;
  font-size: 13px !important;
  color: #444 !important;
  line-height: 1.4 !important;
}

.popup-notes {
  margin-top: 8px !important;
  background: #f7f9fb !important;
  padding: 8px !important;
  border-radius: 6px !important;
  font-size: 13px !important;
  color: #333 !important;
  border: 1px solid rgba(0,0,0,0.04) !important;
}

.popup-content p strong {
  color: #666 !important;
  font-weight: 500 !important;
}

/* Make popup tip smaller and cleaner */
.leaflet-popup-tip {
  width: 12px !important;
  height: 12px !important;
  margin-left: -6px !important;
}

/* nudge the popup slightly upward to keep the pin visible */
.leaflet-popup {
  transform: translateY(-6px) !important;
}

/* Ensure popups appear above overlay controls during animation */
.leaflet-popup,
.leaflet-popup-pane,
.leaflet-container .leaflet-popup {
  z-index: 9999 !important;
  pointer-events: auto !important;
}

/* Ensure popup wrapper and content are visible and not clipped */
.leaflet-container .leaflet-popup,
.leaflet-popup-pane .leaflet-popup,
.leaflet-popup {
  display: block !important;
  opacity: 1 !important;
  visibility: visible !important;
}

/* make sure close button is clickable and visible */
.leaflet-popup .leaflet-popup-close-button {
  z-index: 10001 !important;
}

/* Popup actions (Edit button) */
.popup-actions {
  margin-top: 12px !important;
  padding-top: 8px !important;
  border-top: 1px solid #e0e0e0 !important;
  text-align: right !important;
}

.popup-actions .edit-btn {
  background: #1976d2 !important;
  color: white !important;
  border: none !important;
  border-radius: 4px !important;
  padding: 6px 12px !important;
  font-size: 12px !important;
  font-weight: 500 !important;
  cursor: pointer !important;
  transition: background-color 0.2s ease !important;
  font-family: inherit !important;
}

.popup-actions .edit-btn:hover {
  background: #1565c0 !important;
}

.popup-actions .edit-btn:active {
  background: #0d47a1 !important;
}

/* Overlay controls (styled like the screenshot) */
.map-overlay {
  position: absolute;
  left: 12px;
  top: 12px;
  z-index: 1100; /* above Leaflet default controls */
  pointer-events: auto;
}

.map-controls {
  background: #fff;
  border-radius: 8px;
  box-shadow: 0 6px 18px rgba(16,24,40,0.08);
  padding: 10px 12px;
  min-width: 320px;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
}

.controls-row { display: flex; gap: 8px; align-items: center; }
.speed-row { margin-top: 8px; align-items: center; }
.speed-row input[type="range"] { margin-left: 8px; flex: 1; }
.speed-value { margin-left: 8px; color: #444; }
.controls-footer { margin-top: 8px; font-style: italic; color: #666; font-size: 0.95rem; }

/* Zoom controls on the left of the map */
.map-zoom-controls { position: absolute; left: 16px; top: 120px; z-index: 40; display: flex; flex-direction: column; gap: 8px; }
.zoom-btn { width: 36px; height: 36px; border-radius: 4px; border: 1px solid rgba(0,0,0,0.08); background: #fff; cursor: pointer; box-shadow: 0 1px 2px rgba(0,0,0,0.06); }

/* Map placeholder grid to give the feel of a tiled map */
.map-container::before {
  content: "";
  position: absolute;
  inset: 0;
  background-image: linear-gradient(rgba(255,255,255,0.06) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.06) 1px, transparent 1px);
  background-size: 200px 200px, 200px 200px;
  pointer-events: none;
  /* Ensure this decorative grid sits behind actual Leaflet tiles and overlays.
     Some browsers/DOM orders caused the pseudo-element to render above tile images,
     making the map appear blank. Setting a low z-index and ensuring the
     Leaflet container is above it fixes that without changing UI. */
  z-index: 0;
}

/* Make sure the real Leaflet container (tiles) render above the decorative grid */
.map-container > .leaflet-container {
  position: relative;
  z-index: 1;
}

/* Markers */
.map-marker {
  position: absolute;
  transform: translate(-50%, -100%);
  z-index: 20;
  display: flex;
  flex-direction: column;
  align-items: center;
  pointer-events: auto;
}

.map-marker .pin {
  width: 18px;
  height: 18px;
  background: linear-gradient(180deg,#ff6b6b,#d84343);
  border-radius: 50% 50% 50% 0;
  transform: rotate(-45deg);
  box-shadow: 0 4px 10px rgba(0,0,0,0.14);
  margin-bottom: 6px;
}

.map-marker .pin-label {
  background: rgba(255,255,255,0.95);
  padding: 4px 8px;
  border-radius: 6px;
  font-size: 0.9rem;
  color: #222;
  box-shadow: 0 4px 10px rgba(0,0,0,0.06);
}

.loading, .error { padding: 16px; }

/* control button styles */
button.primary { background: #1e88e5; color: #fff; border: none; padding: 6px 10px; border-radius: 6px; cursor: pointer; }
button.primary:disabled { opacity: 0.6; cursor: default; }

@media (max-width: 768px) {
  .map-controls { min-width: 260px; }
  .map-container, .map-wrapper { height: 480px; }
}

/* Leaflet marker animation hook used during Play Animation */
.hm-animate {
  animation: hm-bounce 1.5s ease-in-out;
  transform-origin: 50% 100%;
}

/* DivIcon pin styling (used for predictable DOM for animations) */
.hm-div-icon {
  pointer-events: none; /* allow clicks to pass through to marker layer */
}
.hm-div-icon .hm-pin-wrapper {
  display: inline-block;
  transform-origin: center bottom;
}
.hm-div-icon .hm-pin {
  width: 18px;
  height: 18px;
  display: block;
  background: #1976d2;
  border-radius: 50% 50% 50% 0;
  transform: rotate(-45deg) translateY(-2px);
  box-shadow: 0 1px 3px rgba(0,0,0,0.3);
  border: 2px solid white;
}

/* apply the bounce to the wrapper so rotation/anchor feel natural */
.hm-div-icon .hm-pin-wrapper.hm-animate {
  animation: hm-bounce 1.5s ease-in-out;
}

/* Make the animation more dramatic and visible */
@keyframes hm-bounce {
  0% { transform: translateY(0) scale(1); }
  25% { transform: translateY(-25px) scale(1.3); }
  50% { transform: translateY(-10px) scale(1.1); }
  75% { transform: translateY(-15px) scale(1.2); }
  100% { transform: translateY(0) scale(1); }
}

/* Floating popup (rendered above map container so it cannot be occluded) */
.hm-floating-popup {
  position: absolute;
  transform: translate(-50%, -120%); /* center horizontally and place above the pin */
  z-index: 20000 !important;
  pointer-events: auto !important;
}

.hm-floating-popup .popup-content {
  background: #ffffff !important;
  color: #222 !important;
  padding: 10px 12px !important;
  border-radius: 8px !important;
  min-width: 200px !important;
  max-width: 320px !important;
  box-shadow: 0 8px 20px rgba(0,0,0,0.18) !important;
  border: 1px solid rgba(0,0,0,0.06) !important;
}

/* Close button for floating popups */
.hm-floating-popup .popup-close {
  position: absolute;
  right: 8px;
  top: 8px;
  background: transparent;
  border: none;
  font-size: 18px;
  line-height: 1;
  cursor: pointer;
  color: #666;
  padding: 2px 6px;
  border-radius: 4px;
}
.hm-floating-popup .popup-close:hover {
  background: rgba(0,0,0,0.04);
  color: #111;
}
